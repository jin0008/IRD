#data-preprocessing for b37_decoy

REF=/home/jin0008/db/refs/b37/human_g1k_v37_decoy.fasta
R1=7731849-KTH-BL1_1.fastq.gz
R2=7731849-KTH-BL1_2.fastq.gz

#FastqTOSAM
gatk --java-options "-Xmx16G" FastqToSam \
-F1 $R1 \
-F2 $R2 \
-O unmapped.bam \
-SM KTH \
-RG KTHL_BL1

#BWA
bwa mem -M -t 16  $REF $R1 $R2 > mapped.bam

#MergeBamAlignment
gatk --java-options "-Xmx16G" MergeBamAlignment \
--VALIDATION_STRINGENCY SILENT \
--EXPECTED_ORIENTATIONS FR \
--ATTRIBUTES_TO_RETAIN X0 \
--ALIGNED_BAM mapped.bam \
--UNMAPPED_BAM unmapped.bam \
--OUTPUT input.bam \
--REFERENCE_SEQUENCE $REF \
--PAIRED_RUN true \
--SORT_ORDER "unsorted" \
--IS_BISULFITE_SEQUENCE false \
--ALIGNED_READS_ONLY false \
--CLIP_ADAPTERS false \
--MAX_RECORDS_IN_RAM 2000000 \
--ADD_MATE_CIGAR true \
--MAX_INSERTIONS_OR_DELETIONS -1 \
--PRIMARY_ALIGNMENT_STRATEGY MostDistant \
--UNMAPPED_READ_STRATEGY COPY_TO_TAG \
--ALIGNER_PROPER_PAIR_FLAGS true \
--UNMAP_CONTAMINANT_READS true

#SortSam
gatk --java-options "-Xmx16G" SortSam \
--INPUT input.bam \
--OUTPUT sort.bam \
--SORT_ORDER "coordinate" \
--CREATE_INDEX false \
--CREATE_MD5_FILE false 

#SetNmMdAndUqTags
gatk --java-options "-Xmx16G" SetNmMdAndUqTags \
--INPUT sort.bam \
--OUTPUT sort_fixed.bam \
--CREATE_INDEX true \
--CREATE_MD5_FILE true \
--REFERENCE_SEQUENCE $REF

#MarkDuplicates
gatk --java-options "-Xmx16G" MarkDuplicates \
--INPUT sort_fixed.bam \
--OUTPUT markduplicated.bam \
--METRICS_FILE metrics_profile \
--VALIDATION_STRINGENCY SILENT \
--OPTICAL_DUPLICATE_PIXEL_DISTANCE 2500 \
--ASSUME_SORT_ORDER "queryname" \
--CREATE_MD5_FILE true

#BaseRecalibrator
gatk --java-options "-Xmx16G" BaseRecalibrator \
-R $REF \
-I markduplicated.bam \
--use-original-qualities \
-O recal_data.table \
--known-sites /home/jin0008/db/refs/b37/dbsnp_138.b37.vcf \
--known-sites /home/jin0008/db/refs/b37/Mills_and_1000G_gold_standard.indels.b37.vcf \
--known-sites /home/jin0008/db/refs/b37/1000G_phase1.indels.b37.vcf \
-L /home/jin0008/db/refs/interval_list/Broad.human.exome.b37.interval_list

#BQSR
gatk --java-options "-Xmx16G" ApplyBQSR \
-R $REF \
-I markduplicated.bam \
-O analysisready.bam \
-L /home/jin0008/db/refs/interval_list/Broad.human.exome.b37.interval_list \
-bqsr recal_data.table \
--static-quantized-quals 10 --static-quantized-quals 20 --static-quantized-quals 30 \
--add-output-sam-program-record \
--create-output-bam-md5 \
--use-original-qualities


